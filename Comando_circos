
#Tutorial de https://bioinf.cc/
#Make a fai file

export PATH=/home/andres/Documents/Software/Samtools/samtools-1.10/bin:$PATH
samtools faidx VN6_Canu_IP.fasta

#Make a karyogram file
awk '{print "chr - "$1" "$1" 0 "$2" white"}' VS4-2_Final.fasta.fai > chr.kar

#Calculate average coverage in a 8.5 Mb genome, making ~1000 windows to calculate therefore, 16 kb windows with 8 kb steps
#Archivo .bam está el detalle en comando_bwa.txt

bedtools makewindows -g VS4-2_Final.fasta.fai -w 16000 -s 8000 > genome.windows

~/Documents/Software/Samtools/samtools-1.10/bin/samtools index VS4-2_Final.fasta.bam

bedtools multicov -bams VS4-2_Final.fasta.bam -bed genome.windows > genome.cov

#Get vcf file with SNPs

samtools mpileup -A -x -B -f VN6_Canu_IP.fasta output.bam > intermediate.txt

java -jar ~/Documents/Software/Varscan/VarScan.v2.3.9.jar mpileup2snp intermediate.txt --p-value 1e-5 --output-vcf | grep -P '#|HET=1'  > VN6.snp.vcf


#Get SNPs density (with an already existing vcf file) 

bedtools intersect -a genome.windows -b VN6.snp.vcf -c \
 | awk '{$4*=-1;print}' > genome.snps


#Archivo con contigs e inicio de cada CDS. Primero el archivo .gff de la anotación lo edité manualmente y eliminé las primeras lineas. luego usé este comando y finalmente eliminé manualmente las secuencias fasta del final y en excel separé las bandas + de las - y busqué manualmente los BGCs mirando antismash y les puse distintos colores

awk '{print ""$1" "$4" "$5" "$7" yellow"}' VS4-2_editada_prueba_circos.gff > CDSs_1.txt



#GC content. Primero uní todos los contigs de la cepa en un solo archivo sin separación por >. luego calculé el porcentaje de GC para una ventana de 1000 bp con el siguiente código y luego en excel hice otras ediciones

GC_analysis.py -i VS4-2_Final.fasta -o VS4_GC -w 1000 -s 1000

#GC skew. usé este comando y luego edité el archivo en excel para agregar una columna que indique el fin de cada ventana

~/Documents/Software/GC_skew_python/src/gcskew.py -i VS4-2_Final_ordenado_conc.fasta -o GCskew.txt -k 1000

#Ejecuta circos (es importante que conf file se llame circos.conf)

export PATH="~/Documents/Software/Circos/circos-0.69-9/bin/:$PATH"
circos circos.conf


#Solucionar error (Después de esto se genera la imagen en png)
circos -debug_group _all


